<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Shopping Cart - India Edition</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #22c55e;
            --danger: #ef4444;
            --bg: #f8fafc;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        
        /* Product List Styles */
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .product-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        
        /* Cart Styles */
        .cart-item { font-size: 0.9rem; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .discount-badge { color: var(--success); font-size: 0.8rem; font-weight: bold; }
        
        button { cursor: pointer; border: none; border-radius: 4px; padding: 5px 10px; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-remove { background: var(--danger); color: white; padding: 2px 6px; }
        
        .totals { margin-top: 15px; border-top: 2px solid #eee; padding-top: 10px; }
        .coupon-section { margin-top: 15px; }
        input[type="text"] { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        .applied-rules { font-size: 0.75rem; color: var(--secondary); font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Available Products</h2>
        <div id="product-list"></div>
    </div>

    <div class="card">
        <h2>Your Cart</h2>
        <div id="cart-items">
            <p style="color: gray;">Cart is empty</p>
        </div>
        
        <div class="coupon-section">
            <input type="text" id="coupon-input" placeholder="Enter Coupon (e.g. SAVE10)">
            <button onclick="applyCoupon()" class="btn-add" style="width: 100%;">Apply Coupon</button>
            <p id="coupon-msg" style="font-size: 0.8rem;"></p>
        </div>

        <div class="totals">
            <div class="cart-item"><span>Subtotal:</span> <span id="subtotal">₹0.00</span></div>
            <div class="cart-item"><span>Discounts:</span> <span id="discount-total" style="color: green;">-₹0.00</span></div>
            <hr>
            <div class="cart-item"><strong>Total:</strong> <strong id="grand-total">₹0.00</strong></div>
        </div>
    </div>
</div>

<script>
    // 1. Product Data (Prices updated to typical INR values)
    const products = [
        { id: 1, name: "Wireless Headphones", price: 2499, category: "Electronics" },
        { id: 2, name: "Coffee Mug", price: 450, category: "Home" },
        { id: 3, name: "Mechanical Keyboard", price: 3200, category: "Electronics" },
        { id: 4, name: "Desk Lamp", price: 1200, category: "Home" }
    ];

    let cart = [];
    let activeCoupon = "";

    // Helper function to format currency for India (INR)
    function formatINR(amount) {
        return "₹" + amount.toLocaleString('en-IN', {
            maximumFractionDigits: 2,
            minimumFractionDigits: 2
        });
    }

    // 2. Initialize Product List
    function initProducts() {
        const list = document.getElementById('product-list');
        list.innerHTML = products.map(p => `
            <div class="product-item">
                <div>
                    <strong>${p.name}</strong><br>
                    <small>${p.category} - ${formatINR(p.price)}</small>
                </div>
                <button class="btn-add" onclick="addToCart(${p.id})">Add to Cart</button>
            </div>
        `).join('');
    }

    // 3. Cart Logic
    function addToCart(id) {
        const product = products.find(p => p.id === id);
        const existing = cart.find(item => item.id === id);

        if (existing) {
            existing.quantity += 1;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        renderCart();
    }

    function updateQuantity(id, delta) {
        const item = cart.find(i => i.id === id);
        if (item) {
            item.quantity += delta;
            if (item.quantity <= 0) {
                cart = cart.filter(i => i.id !== id);
            }
        }
        renderCart();
    }

    // 4. Rule-Driven Discount Logic
    function calculateDiscounts(subtotal) {
        let totalDiscount = 0;
        let rulesApplied = [];

        // Rule A: Bulk Discount (10% off if buying 3+ of any single item)
        cart.forEach(item => {
            if (item.quantity >= 3) {
                const discount = (item.price * item.quantity) * 0.1;
                totalDiscount += discount;
                rulesApplied.push(`Bulk: 10% off ${item.name}`);
            }
        });

        // Rule B: Category Discount (Electronics Flash Sale - 5% off)
        const hour = new Date().getHours();
        if (hour >= 9 && hour <= 17) {
            const electronics = cart.filter(i => i.category === "Electronics");
            const eSubtotal = electronics.reduce((sum, i) => sum + (i.price * i.quantity), 0);
            if (eSubtotal > 0) {
                totalDiscount += eSubtotal * 0.05;
                rulesApplied.push("Happy Hour: 5% off Electronics");
            }
        }

        // Rule C: Coupon Code Parsing/Validation
        if (activeCoupon.toUpperCase().trim() === "SAVE10") {
            totalDiscount += subtotal * 0.10;
            rulesApplied.push("Coupon: 10% Flat Discount");
        }

        return { totalDiscount, rulesApplied };
    }

    // 5. Render/Display Update
    function renderCart() {
        const cartContainer = document.getElementById('cart-items');
        const subtotalEl = document.getElementById('subtotal');
        const discountEl = document.getElementById('discount-total');
        const grandTotalEl = document.getElementById('grand-total');

        if (cart.length === 0) {
            cartContainer.innerHTML = '<p style="color: gray;">Cart is empty</p>';
            subtotalEl.innerText = "₹0.00";
            discountEl.innerText = "-₹0.00";
            grandTotalEl.innerText = "₹0.00";
            return;
        }

        let subtotal = 0;
        cartContainer.innerHTML = cart.map(item => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;
            return `
                <div class="cart-item">
                    <span>${item.name} (x${item.quantity})</span>
                    <span>
                        ${formatINR(itemTotal)}
                        <button class="btn-remove" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <button style="background:#ddd" onclick="updateQuantity(${item.id}, 1)">+</button>
                    </span>
                </div>
            `;
        }).join('');

        const { totalDiscount, rulesApplied } = calculateDiscounts(subtotal);
        
        subtotalEl.innerText = formatINR(subtotal);
        discountEl.innerText = "-" + formatINR(totalDiscount);
        grandTotalEl.innerText = formatINR(subtotal - totalDiscount);

        // Display applied rules
        if(rulesApplied.length > 0) {
            cartContainer.innerHTML += `<div class="applied-rules">Rules: ${rulesApplied.join(', ')}</div>`;
        }
    }

    function applyCoupon() {
        const input = document.getElementById('coupon-input').value;
        const msg = document.getElementById('coupon-msg');
        
        if (input.length < 4) {
            msg.style.color = 'red';
            msg.innerText = "Invalid code length.";
            return;
        }

        activeCoupon = input;
        msg.style.color = 'green';
        msg.innerText = "Coupon applied!";
        renderCart();
    }

    initProducts();
</script>

</body>
</html>