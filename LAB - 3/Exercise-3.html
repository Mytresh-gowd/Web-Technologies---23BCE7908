<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Survey Builder</title>
    <style>
        :root {
            --primary: #6366f1;
            --error: #ef4444;
            --text: #1e293b;
            --bg: #f1f5f9;
        }

        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 40px 20px; }
        .survey-card { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        
        h1 { margin-top: 0; color: var(--primary); }
        .question-block { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
        .question-label { font-weight: 600; display: block; margin-bottom: 10px; }
        
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; }
        .options-group { display: flex; flex-direction: column; gap: 8px; }
        
        .error-msg { color: var(--error); font-size: 0.85rem; margin-top: 5px; display: none; }
        .invalid input { border-color: var(--error); }
        .invalid .error-msg { display: block; }

        button { 
            background: var(--primary); color: white; border: none; padding: 12px 24px; 
            border-radius: 6px; font-weight: 600; cursor: pointer; width: 100%; font-size: 1rem;
        }
        button:hover { opacity: 0.9; }
        
        #success-msg { display: none; text-align: center; color: #15803d; background: #f0fdf4; padding: 15px; border-radius: 6px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="survey-card">
    <h1>Customer Feedback Survey</h1>
    <form id="dynamic-survey">
        <div id="questions-container"></div>
        <button type="submit">Submit Responses</button>
    </form>
    <div id="success-msg">ðŸŽ‰ Survey submitted successfully! Check the console for data.</div>
</div>

<script>
    // 1. Data Structure for Questions
    const surveyQuestions = [
        {
            id: "q1",
            type: "text",
            label: "What is your full name?",
            required: true,
            minLength: 3
        },
        {
            id: "q2",
            type: "radio",
            label: "How satisfied are you with our service?",
            options: ["Excellent", "Good", "Fair", "Poor"],
            required: true
        },
        {
            id: "q3",
            type: "checkbox",
            label: "Which features do you use? (Select at least 2)",
            options: ["Mobile App", "Web Portal", "API Access", "Offline Mode"],
            minSelection: 2
        }
    ];

    const container = document.getElementById('questions-container');

    // 2. Generate Form Dynamically
    function buildSurvey() {
        surveyQuestions.forEach(q => {
            const block = document.createElement('div');
            block.className = 'question-block';
            block.id = `block-${q.id}`;

            const label = document.createElement('label');
            label.className = 'question-label';
            label.innerText = q.label + (q.required || q.minSelection ? ' *' : '');
            block.appendChild(label);

            if (q.type === 'text') {
                const input = document.createElement('input');
                input.type = 'text';
                input.name = q.id;
                input.placeholder = "Your answer...";
                block.appendChild(input);
            } 
            else if (q.type === 'radio' || q.type === 'checkbox') {
                const group = document.createElement('div');
                group.className = 'options-group';
                
                q.options.forEach(opt => {
                    const wrapper = document.createElement('label');
                    wrapper.style.fontWeight = 'normal';
                    wrapper.innerHTML = `
                        <input type="${q.type}" name="${q.id}" value="${opt}"> ${opt}
                    `;
                    group.appendChild(wrapper);
                });
                block.appendChild(group);
            }

            const error = document.createElement('div');
            error.className = 'error-msg';
            error.id = `error-${q.id}`;
            block.appendChild(error);

            container.appendChild(block);
        });
    }

    // 3. & 4. Validation Logic
    function validateForm(e) {
        e.preventDefault();
        let isFormValid = true;
        const formData = new FormData(e.target);
        const results = {};

        surveyQuestions.forEach(q => {
            const block = document.getElementById(`block-${q.id}`);
            const errorEl = document.getElementById(`error-${q.id}`);
            let isValid = true;
            let message = "";

            // Logic for Text inputs
            if (q.type === 'text') {
                const val = formData.get(q.id).trim();
                if (q.required && !val) {
                    isValid = false;
                    message = "This field is required.";
                } else if (q.minLength && val.length < q.minLength) {
                    isValid = false;
                    message = `Minimum ${q.minLength} characters required.`;
                }
                results[q.id] = val;
            }

            // Logic for Selection inputs
            if (q.type === 'radio') {
                const val = formData.get(q.id);
                if (q.required && !val) {
                    isValid = false;
                    message = "Please select an option.";
                }
                results[q.id] = val;
            }

            if (q.type === 'checkbox') {
                const vals = formData.getAll(q.id);
                if (q.minSelection && vals.length < q.minSelection) {
                    isValid = false;
                    message = `Please select at least ${q.minSelection} options.`;
                }
                results[q.id] = vals;
            }

            // 5. DOM Manipulation for Errors
            if (!isValid) {
                block.classList.add('invalid');
                errorEl.innerText = message;
                isFormValid = false;
            } else {
                block.classList.remove('invalid');
            }
        });

        // 6. Prevent submission or show success
        if (isFormValid) {
            console.log("Survey Data Collected:", results);
            document.getElementById('dynamic-survey').style.display = 'none';
            document.getElementById('success-msg').style.display = 'block';
        }
    }

    // Initialize
    buildSurvey();
    document.getElementById('dynamic-survey').addEventListener('submit', validateForm);
</script>

</body>
</html>